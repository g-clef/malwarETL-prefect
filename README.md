# malwarETL-prefect
settings used to install Prefect in a k8s cluster.

This is the only component (though, I grant, an important one) that is not installed primarily in k8s. The reason for 
that is that my k8s cluster setup (lxc/lxd/juju/charmed-kubernetes) seems to have a bug where pods cannot talk to 
services where the selected pod to answer the service is on the same node (hairpinning traffic). This could, in theory,
be handled by setting a bunch of pod anti-affinity rules, or by doing the yak-shaving to find the bug in either lxd,
charmed's implementation of flannel, or some other thing, but frankly, I've got better things to do with my time.

So, instead, the system is set up as follows:
    a VM on my NAS system runs the core of prefect (the UI, the storage, hasura, graphql, etc)
    That VM has postgresql installed on it as the persistent storage for the system
    I installed prefect in a venv with the `[kubernetes]` option
    I used the `<>` command to generate the kubernetes deploy for the *agents*, and modified it to include environment
    variables for connection info for ElasticSearch, and added PersistentVolume mounts for the malware repository and 
    the results directories. 